<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style/css/index.css">
    <title>登录</title>
    <style type="text/css" media="screen">
        @font-face {
            font-family: 'iconfont';
            src: url('fonts/iconfont.eot');
            src: url('fonts/iconfont.eot?#iefix') format('embedded-opentype'), url('fonts/iconfont.woff') format('woff'), url('fonts/iconfont.ttf') format('truetype'), url('fonts/iconfont.svg#iconfont') format('svg');
        }
        
        .iconfont {
            font-family: "iconfont" !important;
            font-size: 16px;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: 0.2px;
            -moz-osx-font-smoothing: grayscale;
        }
        
        html,
        body {
            height: 100%;
        }
        
        body {
            background: url(style/images/register_bg.png) no-repeat;
            background-size: cover;
        }
        
        .box {
            padding: 0.533333rem 0.4rem;
        }
        
        .close {
            text-align: right;
        }
        
        .close img {
            width: 0.666667rem;
            height: 1.173333rem;
        }
        
        .logo {
            text-align: center;
            padding-top: 0.533333rem;
            padding-bottom: 1.333333rem;
        }
        
        .logo img {
            width: 1.96rem;
            height: 1.853333rem;
        }
        
        div.form {
            padding: 0 1.066667rem;
        }
        
        .inputwrap {
            padding-top: 0.64rem;
            border-bottom: 1px solid #e1e1e1;
            /*padding-left: 0.786667rem;*/
        }
        
        .inputwrap input {
            line-height: 0.893333rem;
            -webkit-appearance: none;
            background: none;
            border: none;
        }
        
        .font14 {
            font-size: 14px;
        }
        
        [data-dpr="2"] .font14 {
            font-size: 28px;
        }
        
        [data-dpr="3"] .font14 {
            font-size: 42px;
        }
        
        .font15 {
            font-size: 15px;
        }
        
        [data-dpr="2"] .font15 {
            font-size: 30px;
        }
        
        [data-dpr="3"] .font15 {
            font-size: 45px;
        }
        
        .font16 {
            font-size: 16px;
        }
        
        [data-dpr="2"] .font16 {
            font-size: 32px;
        }
        
        [data-dpr="3"] .font16 {
            font-size: 48px;
        }
        
        .font18 {
            font-size: 18px;
        }
        
        [data-dpr="2"] .font18 {
            font-size: 36px;
        }
        
        [data-dpr="3"] .font18 {
            font-size: 54px;
        }
        
        div.code {
            position: relative;
        }
        
        span.timetip {
            position: absolute;
            right: 0;
            bottom: 0.133333rem;
            border: 1px solid #999;
            color: #999;
            padding: 0.066667rem;
        }
        
        .btnwrap {
            margin-top: 1.293333rem;
            color: #1a1a1a;
        }
        
        .btnwrap input {
            border: 1px solid #1a1a1a;
            margin: 0 auto;
            width: 100%;
            line-height: 1.066667rem;
            background: none;
        }
        
        .links {
            border-bottom: none;
        }
        
        .links a {
            color: #666;
            line-height: 0.8rem;
            border-bottom: 1px solid #e1e1e1;
            padding-bottom: 0.133333rem;
        }
        
        .clearfix {
            clear: both;
        }
        
        .clearfix:before {
            content: ".";
            display: block;
            clear: both;
            height: 0;
            font-size: 0;
            visibility: hidden;
            overflow: hidden;
        }
        
        .clearfix:after {
            content: ".";
            display: block;
            clear: both;
            height: 0;
            font-size: 0;
            visibility: hidden;
            overflow: hidden;
        }
        
        .fl {
            float: left;
        }
        
        .fr {
            float: right;
        }
    </style>
</head>

<body>
    <div class="box" id="app" v-cloak>
        <div class="close"><img src="style/images/close_btn.png" alt="" @click="closeWin()"></div>
        <div class="logo">
            <img src="style/images/login_logo_03.png" alt="">
        </div>
        <div class="form font15">
            <form action="#" method="post">
                <div class="inputwrap">
                    <i class="iconfont font18">&#xe60f;</i>
                    <input type="text" name="username" placeholder="用户名" v-model.trim="username">
                </div>
                <div class="inputwrap">
                    <i class="iconfont font18">&#xe616;</i>
                    <input type="password" name="password" placeholder="密码/Password" v-model="password">
                </div>
                <div class="inputwrap font15  links">
                    <div class="clearfix">
                        <div class="fl">
                            <a @click="toRegister()">注册新账号</a>
                        </div>
                        <div class="fr">
                            <a @click="toFindPassword()">忘记密码？</a>
                        </div>
                    </div>
                </div>
                <div class="btnwrap">
                    <input type="button" value="登录" v-bind:class="{ active: isActive }" @click="login()">
                </div>
            </form>
        </div>

    </div>
</body>
<script src="../../script/api.js" type="text/javascript" charset="utf-8"></script>
<script src="../../script/flexible.js" type="text/javascript" charset="utf-8"></script>
<script src="../../script/vue.js" type="text/javascript" charset="utf-8"></script>
<script src="../../script/fastclick.js" type="text/javascript" charset="utf-8"></script>
<script src="../../script/funcTools.js" type="text/javascript" charset="utf-8"></script>
<script src="../../script/sessions.js" type="text/javascript" charset="utf-8"></script>

<script>
    var vm = new Vue({
        el: "#app",
        data: {
            username: "",
            password: "",
            isActive: false,
            userEntity: {}
        },
        methods: {
            toRegister: function() {
                api.openWin({
                    name: 'win_regist',
                    url: 'win_regist.html'
                });
            },
            toFindPassword: function() {
                api.openWin({
                    name: 'win_findPassword',
                    url: 'win_findPassword.html'
                });
            },
            login: function() {
                if (!this.isActive) {
                    return false;
                }

                var url = ajaxAgent.serverAction + '/app/login';
console.log(api.deviceId+"---"+vm.username+"---"+vm.password);
                api.showProgress();
                api.ajax({
                    url: url,
                    method: 'post',
                    timeout: 30,
                    dataType: 'json',
                    returnAll: false,
                    data: {
                        values: {
                            deviceId: api.deviceId,
                            username: vm.username,
                            password: vm.password,
                        }
                    }
                }, function(ret, err) {
                    api.hideProgress();
                    console.log(JSON.stringify(ret));

                    if (ret.resultCode == 10000) {
                        var data = ret.resultData;
                        vm.userEntity = {
                            userId: 　data.id,
                            userName: data.username,
                            cellPhone: data.mobile,
                            nickName: data.nickName,
                            headImgPath: data.headimg,
                        }
                        sessionAgent.setLoginInfo(vm.userEntity);

                        api.execScript({
                            name: 'win_poliContent',
                            script: 'reFresh();'
                        });
                        api.closeWin();
                    } else if(ret.resultCode == 90026){
                    	api.toast({
                            msg: '当前账号已在其他设备登陆！',
                            location: 'middle',
                        });
                    }else{
                        api.toast({
                            msg: ret.resultMessage,
                            location: 'middle',
                        });
                    }
                });
            },
            closeWin: function() {
                api.closeWin();
            },
            changeText: function() {
                this.isActive = this.username != '' && this.password != '';
            }
        },
        watch: {
            username: function(newValue,
                oldValue) {
                this.changeText();
            },
            password: function(newValue,
                oldValue) {
                this.changeText();

            }
        },
    });

    apiready = function() {

        FastClick.attach(document.body);

    }
</script>

</html>